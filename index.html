<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>事件卡驅動 RF 監控系統</title>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script> -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" /> -->
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
    <body>
        <!-- 主介面 -->
        <div class="system-layout">
            <!-- 左側：事件列表 -->
            <div class="events-sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">
                        事件管理中心
                    </div>
                    <button class="new-event-btn" onclick="showNewEventModal()">
                        + 新增事件卡
                    </button>
                </div>
                
                <div class="events-container">
                    <div class="event-card" onclick="selectEvent(this, 'area-001')">
                        <div class="event-card-header">
                            <span class="event-id">AREA-001</span>
                            <span class="event-type-badge type-area">區域監控</span>
                        </div>
                        <div class="event-info">
                            監控區域：台海北部海域<br>
                            監控時間: 讀取中<br>
                        </div>
                        <div class="event-status">
                            <div class="status-dot status-investigating"></div>
                            <span>調查中</span>
                        </div>
                    </div>

                    <div class="event-card" onclick="selectEvent(this, 'rf-002')">
                        <div class="event-card-header">
                            <span class="event-id">RF-002</span>
                            <span class="event-type-badge type-rf">RF 監控</span>
                        </div>
                        <div class="event-info">
                            RF 信號 ID: 讀取中<br>
                            座標: 讀取中<br>
                        </div>
                        <div class="event-status">
                            <div class="status-dot status-analyzed"></div>
                            <span>已獲取RF資訊</span>
                        </div>
                    </div>

                    <div class="event-card" onclick="selectEvent(this, 'vessel-003')">
                        <div class="event-card-header">
                            <span class="event-id">VESSEL-003</span>
                            <span class="event-type-badge type-vessel">船舶監控</span>
                        </div>
                        <div class="event-info">
                            風險分數: 讀取中<br>
                            座標: 讀取中<br>
                            AIS 狀態: 讀取中
                        </div>
                        <div class="event-status">
                            <div class="status-dot status-investigating"></div>
                            <span>等待決策</span>
                        </div>
                    </div>

                    <!-- <div class="event-card" onclick="selectEvent(this, 'vessel-004')">
                        <div class="event-card-header">
                            <span class="event-id">VESSEL-004</span>
                            <span class="event-type-badge type-vessel">船舶監控</span>
                        </div>
                        <div class="event-info">
                            MMSI: 416789012<br>
                            座標: 24.789°N, 120.234°E<br>
                            風險分數: 28/100
                        </div>
                        <div class="event-status">
                            <div class="status-dot status-completed"></div>
                            <span>已結束</span>
                        </div>
                    </div> -->
                </div>
            </div>

            <!-- 中間：地圖區域 -->
            <div class="map-section">
                <div class="map-container">
                    <!-- Dynamic Map -->
                    <div id="taiwanMap" style="width: 100%; height: 100%;"></div>
                    <!-- 縮放重置按鈕 -->
                    <div class="zoom-reset-btn" onclick="resetMapZoom()" title="重置地圖縮放">
                        <span class="zoom-text">重置</span>
                    </div>
                    <!-- Static Map -->
                    <!-- 保留原有的 map-overlay -->
                    <!-- <div class="map-placeholder">
                        🗺️ 台灣海域互動地圖
                        <div style="font-size: 14px; margin-top: 10px; opacity: 0.7;">
                            AOI 區域 | 船隻位置 | RF 異常訊號
                        </div>
                    </div> -->
                    <div class="aoi-indicator"></div>
                </div>
                
                <!-- 暫時隱藏overlay -->
                <!-- <div class="map-overlay" id="mapOverlay">
                    <div class="overlay-title">📍 AREA-001 - 台海北部海域</div>
                    <div class="overlay-info">
                        AOI 範圍: 24.2°N-24.8°N, 120.5°E-121.2°E<br>
                        監控狀態: 主動偵測中<br>
                        RF 異常候選: 3 個待調查<br>
                        最後更新: 2025-09-04 14:35
                    </div>
                </div> -->
            </div>

            <!-- 右側：事件詳情 -->
            <div class="details-panel">
                <div class="details-header">
                    <div class="details-title" id="detailsTitle">事件詳情</div>
                    <div class="details-subtitle" id="detailsSubtitle">請選擇左側事件卡查看詳情</div>
                </div>
                
                <div class="details-content" id="detailsContent">
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 300px; color: #64748b; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;">📋</div>
                        <div style="font-size: 16px; font-weight: 500; margin-bottom: 10px;">尚未選擇事件</div>
                        <div style="font-size: 13px; line-height: 1.5; opacity: 0.7;">
                            點擊左側事件卡來查看詳細資訊<br>
                            包含事件簡介、異常候選清單和可用操作
                        </div>
                    </div>
                </div>
            </div>

            <!-- 底部：任務卡與時間軸 -->
            <div class="mission-section">
                <div class="mission-header">
                    <div class="mission-title">任務時間軸</div>
                    <div class="mission-stats">進行中: 2 | 已完成: 1 | 總計: 3</div>
                </div>
                
                <div class="mission-timeline">
                    <div class="mission-card">
                        <div class="mission-card-header">
                            <span class="mission-type">🚁 UAV 派遣</span>
                            <span class="mission-status status-sensing">SENSING</span>
                        </div>
                        <div class="mission-details">
                            事件: VESSEL-003<br>
                            目標: MMSI-416123456<br>
                            酬載: EO/IR 感測器<br>
                            時間窗: 4 小時
                        </div>
                        <div class="mission-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 65%;"></div>
                            </div>
                            <div class="progress-text">進度: 65% | 預計 16:30 完成</div>
                        </div>
                    </div>

                    <div class="mission-card">
                        <div class="mission-card-header">
                            <span class="mission-type">🛰️ 衛星重拍</span>
                            <span class="mission-status status-queued">QUEUED</span>
                        </div>
                        <div class="mission-details">
                            事件: RF-002<br>
                            目標: SIG-4A7B2C<br>
                            類型: 光學影像<br>
                            排程: 15:30
                        </div>
                        <div class="mission-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 15%;"></div>
                            </div>
                            <div class="progress-text">等待執行 | 預計 30 分鐘</div>
                        </div>
                    </div>

                    <!-- <div class="mission-card">
                        <div class="mission-card-header">
                            <span class="mission-type">🎯 持續追蹤</span>
                            <span class="mission-status status-done">DONE</span>
                        </div>
                        <div class="mission-details">
                            事件: VESSEL-004<br>
                            目標: MMSI-416789012<br>
                            持續時間: 2 小時<br>
                            結果: 確認為漁船
                        </div>
                        <div class="mission-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 100%; background: linear-gradient(90deg, #10b981, #059669);"></div>
                            </div>
                            <div class="progress-text">已完成 | 事件已結案</div>
                        </div>
                    </div> -->
                </div>
            </div>
        </div>

        <!-- 新增事件彈窗 -->
        <div class="modal" id="newEventModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">➕ 新增事件卡</div>
                    <button class="close-btn" onclick="closeEventModal()">&times;</button>
                </div>
                
                <!-- 選擇事件類型 -->
                <div class="event-type-selection">
                    <div class="type-option" data-type="area" onclick="selectEventType('area')">
                        <div class="type-option-header">
                            <div class="type-icon">🗺️</div>
                            <div class="type-title">區域監控事件</div>
                        </div>
                        <div class="type-description">
                            輸入 AOI (Area of Interest) 進行區域性 RF 異常偵測，系統將回傳異常候選清單供後續調查。
                        </div>
                    </div>
                    
                    <div class="type-option" data-type="rf" onclick="selectEventType('rf')">
                        <div class="type-option-header">
                            <div class="type-icon">📡</div>
                            <div class="type-title">RF 異常事件</div>
                        </div>
                        <div class="type-description">
                            輸入特定 RF 異常 ID，查看異常詳細資料並建立調查目標。
                        </div>
                    </div>
                    
                    <div class="type-option" data-type="vessel" onclick="selectEventType('vessel')">
                        <div class="type-option-header">
                            <div class="type-icon">🚢</div>
                            <div class="type-title">船舶監控事件</div>
                        </div>
                        <div class="type-description">
                            輸入船舶 MMSI、座標或 AIS 資訊，系統將進行風險分析並提供決策建議。
                        </div>
                    </div>
                </div>
                
                <!-- 區域監控表單 -->
                <div class="form-section" id="areaForm">
                    <div class="form-group">
                        <label class="form-label">AOI 區域名稱</label>
                        <input type="text" class="form-input" placeholder="例：台海北部海域" id="aoiName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">緯度範圍</label>
                        <input type="text" class="form-input" placeholder="24.2°N - 24.8°N" id="latRange">
                    </div>
                    <div class="form-group">
                        <label class="form-label">經度範圍</label>
                        <input type="text" class="form-input" placeholder="120.5°E - 121.2°E" id="lonRange">
                    </div>
                    <div class="form-group">
                        <label class="form-label">監控時間</label>
                        <input type="number" class="form-input" placeholder="24" id="monitorHours" min="1" max="168"> 
                        <small style="color: #b8c5d1; font-size: 11px; margin-top: 4px;">小時 (最長 7 天)</small>
                    </div>
                </div>
                
                <!-- RF 異常表單 -->
                <div class="form-section" id="rfForm">
                    <div class="form-group">
                        <label class="form-label">RF 異常 ID</label>
                        <input type="text" class="form-input" placeholder="例：SIG-4A7B2C" id="rfId">
                    </div>
                    <div class="form-group">
                        <label class="form-label">建立時間 (可選)</label>
                        <input type="datetime-local" class="form-input" id="detectionTime">
                    </div>
                    <div class="form-group">
                        <label class="form-label">備註</label>
                        <textarea class="form-textarea" placeholder="補充說明或相關資訊..." id="rfNotes"></textarea>
                    </div>
                </div>
                
                <!-- 船舶監控表單 -->
                <div class="form-section" id="vesselForm">
                    <div class="form-group">
                        <label class="form-label">MMSI</label>
                        <input type="text" class="form-input" placeholder="例：416123456" id="vesselMMSI">
                    </div>
                    <div class="form-group">
                        <label class="form-label">座標 (可選)</label>
                        <input type="text" class="form-input" placeholder="例：24.456°N, 120.789°E" id="vesselCoords">
                    </div>
                    <div class="form-group">
                        <label class="form-label">船舶名稱 (可選)</label>
                        <input type="text" class="form-input" placeholder="例：漁船阿勇號" id="vesselName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">調查原因</label>
                        <textarea class="form-textarea" placeholder="說明為何需要調查此船舶..." id="investigationReason"></textarea>
                    </div>
                </div>
                
                <div class="modal-actions" id="modalActions" style="display: none;">
                    <button class="btn btn-secondary" onclick="closeEventModal()">取消</button>
                    <button class="btn btn-primary" onclick="createNewEvent()" id="createEventBtn" disabled>建立事件</button>
                </div>
            </div>
        </div>

        <!-- JavaScript -->
        <script src="script.js"></script>
    </body>
</html>